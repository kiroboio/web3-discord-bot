<script src="/socket.io/socket.io.js"></script>
<script>
	const socket = io();
	const user = {
		userId: '',
		account: '',
		sessionId: '',
	};

	window.ethereum.request({ method: "eth_requestAccounts" }).then((accounts) => {
		const account = accounts[0];
		user.account = account;
		if (!user.userId || !account) return;

		socket.emit("account", { account, sessionId: user.sessionId });
	});
	window.ethereum.on('accountsChanged', function (accounts) {
		const account = accounts[0];
		user.account = account;
		if (!user.userId || !account) return;

		socket.emit("account", { account, userId: user.userId, sessionId: user.sessionId });
	})

	socket.on("connect", () => {
		user.sessionId = socket.id
	});

	socket.on("userId", ({ userId }) => {
		user.userId = userId
		if (!user.account) return;

		socket.emit("account", { account: user.account, userId: user.userId, sessionId: user.sessionId });
	})

</script>